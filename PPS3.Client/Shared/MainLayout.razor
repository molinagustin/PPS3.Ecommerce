@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@inject IServUsuario ServUsuario
@inject AuthenticationStateProvider AuthStateProvider

<PageTitle>PPS3.Client</PageTitle>

<div class="page">
    @*Si el usuario posee el nivel requerido de autorizacion, se le mostraran las opciones en el menu de navegacion*@
    <AuthorizeView>
        <Authorized>
            <div class="sidebar">
                <NavMenu />
            </div>
        </Authorized>
    </AuthorizeView>
    <main>
        <div class="top-row px-4">
            <AuthorizeView>
                <Authorized>
                    <button class="btn btn-danger" @onclick="@LogoutUser">
                        <span class="oi oi-account-logout" aria-hidden="true"></span> Cerrar Sesion
                    </button>
                </Authorized>
                <NotAuthorized>
                    <button class="btn btn-primary" @onclick="@Login">
                        <span class="oi oi-account-login" aria-hidden="true"></span> Iniciar Sesion
                    </button>
                </NotAuthorized>
            </AuthorizeView>
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

@code{
    private async Task LogoutUser()
    {
        var result = await ServUsuario.Logout();

        if (result)
        {
            await AuthStateProvider.GetAuthenticationStateAsync();
            NavigationManager.NavigateTo("/");    
        }        
    }

    private void Login()
    {
        NavigationManager.NavigateTo("/login"); 
    }
}